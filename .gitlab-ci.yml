test:
  image: python:3.6
  services:
    - postgres:latest
  variables:
    LC_ALL: C.UTF-8
    LANG: C.UTF-8
    POSTGRES_DB: nice_marmot
    POSTGRES_USER: runner
    POSTGRES_PASSWORD: ""
    SECRET_KEY: "foobar"
    DB_NAME: terra
    DB_HOST: postgres
    DB_USER: runner
    DB_PASSWORD: ""
    BROKER: redis://localhost:6379/0
    SENTRY_DNS: ""
  script:
    - apt-get update -qy
    - apt-get install -y python3-dev python3-pip libgdal-dev libproj-dev
    - pip install pipenv
    - pipenv install
    - pipenv install django-anymail[mailgun] django-rest-auth[with_social] celery[redis] django-storages[google]
    - pipenv run ./manage.py test
